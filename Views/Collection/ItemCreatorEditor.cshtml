@using CourseProject.Data;
@model Item
@using Newtonsoft.Json;
@inject ApplicationDbContext context;
@{
    string buttontext = ViewData["func"].ToString();
    string msg = ViewData["msg"] != null ? ViewData["msg"].ToString() : null;
    var tags = Model.Tags!=null?JsonConvert.SerializeObject(Model.Tags.Select(i => i.Name).ToArray()):null;
    var whitelist = JsonConvert.SerializeObject(context.Tags.Select(i => i.Name).ToArray());
}

<style>
    textarea{
        width:100%;
    }
</style>

<div class="row justify-content-lg-center">
    <div class="col-md-5">
        <section>
            <form id="Item" method="post">
                <h4>@buttontext item</h4>
                <div class="form-group">
                    <label>Name</label>
                    @Html.EditorFor(i => i.Name)
                </div>
                <div class="form-group">
                    <label>Tags</label>
                    <input name="tags">
                </div>
                @if (!string.IsNullOrEmpty(Model.Collection.Line1Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Line1Name</label>
                        @Html.EditorFor(i => i.Line1)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Line2Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Line2Name</label>
                        @Html.EditorFor(i => i.Line2)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Line3Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Line3Name</label>
                        @Html.EditorFor(i => i.Line3)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Integer1Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Integer1Name</label>
                        @Html.EditorFor(i => i.Integer1)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Integer2Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Integer2Name</label>
                        @Html.EditorFor(i => i.Integer2)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Integer3Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Integer3Name</label>
                        @Html.EditorFor(i => i.Integer3)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Boolean1Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Boolean1Name</label>
                        @Html.CheckBoxFor(i => i.Boolean1)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Boolean2Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Boolean2Name</label>
                        @Html.CheckBoxFor(i => i.Boolean2)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Boolean3Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Boolean3Name</label>
                        @Html.CheckBoxFor(i => i.Boolean3)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Date1Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Date1Name</label>
                        @Html.EditorFor(i => i.Date1)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Date2Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Date2Name</label>
                        @Html.EditorFor(i => i.Date2)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Date3Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Date3Name</label>
                        @Html.EditorFor(i => i.Date3)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Text1Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Text1Name</label>
                        @Html.TextAreaFor(i => i.Text1)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Text2Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Text2Name</label>
                        @Html.TextAreaFor(i => i.Text2)

                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.Collection.Text3Name))
                {
                    <div class="form-group">

                        <label>@Model.Collection.Text3Name</label>
                        @Html.TextAreaFor(i => i.Text3)

                    </div>
                }
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">@buttontext</button>
                </div>
            </form>
        </section>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
<script src="@Url.Content("https://unpkg.com/@yaireo/tagify")"></script>
<script src="@Url.Content("https://unpkg.com/@yaireo/tagify/dist/tagify.polyfills.min.js")"></script>
<link href="@Url.Content("https://unpkg.com/@yaireo/tagify/dist/tagify.css")" rel="stylesheet" type="text/css" />


<script>
    var whitelist = @Html.Raw(whitelist);
    var m = '@Html.Raw(msg)';
    var tags = '@Html.Raw(tags)';
    window.onload = function () {
        console.log(whitelist);
        console.log(@Html.Raw(tags))
        tagify.addTags(tags)
    }
    $('#Item').submit(function (e) {
        if ($.trim($("#Name").val()) == "") {
            e.preventDefault();
            alert('You did not fill in the name field');
        }
    });
</script>
<script src="~/js/Tags.js"></script>